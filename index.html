<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Decode and Indent GA4 event request payload</title>
    <style>
        body {
            background-color: #222;
            height: 100vh;
            width: 91vw;
            color: #CCC;
            overflow-y: hidden;
        }
        h3 {
            color: rgb(253, 143, 143);
            font-family: sans-serif;
            display: inline-block;
        }
        a {
            text-decoration: none;
        }
        #text-to-clean {
            background-color: #1c1c1c;
            color: #FFF;
            width: 90vw;
            height: 80vh;
            border: dashed 3px #555;
            padding: 10px;
        }
        #clean-text {
            background-color: darkred;
            color: #FFF;
            position: relative;
            float: left;
        }
        main:hover #text-to-clean {
            background-color: #111;
            border: solid 3px darkred;
        }
        #clean-text:hover {
            background-color: rgb(250, 102, 139);
            color: #000;
        }
        #ga-logo svg {
            position: relative;
            float: right;
            width: 80px;
            height: 30px;
            margin-right: 1.7em;
            padding-top: 1em;
        }
        #ga-logo span {
            padding-top: 5vh;
        }
    </style>
</head>
<body>
    <span id="ga-logo">
        <a href="https://analytics.google.com/" target="_blank" title="Google Analytics">
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 450 154.87" height="206.493" width="600"><defs><symbol id="prefix__a" overflow="visible"><path d="M5.5-10L3.562-4.64h3.954L5.562-10zM1.89 0H.204l4.469-11.875h1.734L10.875 0H9.187l-1.14-3.219h-5zm0 0"/></symbol><symbol id="prefix__b" overflow="visible"><path d="M.922-8.125H2.39V-7h.062c.227-.395.582-.723 1.063-.984.488-.27.988-.407 1.5-.407 1 0 1.765.29 2.296.86.54.562.813 1.37.813 2.422V0H6.594v-5c-.032-1.332-.7-2-2-2-.606 0-1.117.25-1.532.75-.406.492-.609 1.074-.609 1.75V0H.922zm0 0"/></symbol><symbol id="prefix__c" overflow="visible"><path d="M2.047-2.484c0 .398.164.73.5 1 .332.261.726.39 1.187.39.633 0 1.204-.234 1.704-.703.507-.476.765-1.039.765-1.687-.48-.375-1.148-.563-2-.563-.617 0-1.133.152-1.547.453-.406.293-.61.664-.61 1.11zm1.969-5.907c1.125 0 2.007.305 2.656.907.656.605.984 1.433.984 2.484v5H6.203v-1.125h-.062c-.637.93-1.48 1.39-2.532 1.39C2.711.266 1.961 0 1.36-.53.766-1.062.47-1.723.47-2.516c0-.843.316-1.507.953-2 .633-.5 1.484-.75 2.547-.75.906 0 1.648.164 2.234.485v-.344c0-.531-.215-.977-.64-1.344a2.127 2.127 0 00-1.47-.562c-.855 0-1.527.36-2.015 1.078L.734-6.797C1.473-7.859 2.566-8.39 4.016-8.39zm0 0"/></symbol><symbol id="prefix__d" overflow="visible"><path d="M2.453-11.875V0H.922v-11.875zm0 0"/></symbol><symbol id="prefix__e" overflow="visible"><path d="M8.188-8.125L3.093 3.578H1.53l1.89-4.094L.064-8.125h1.656L4.14-2.281h.03l2.36-5.844zm0 0"/></symbol><symbol id="prefix__f" overflow="visible"><path d="M4.14.125c-.656 0-1.202-.203-1.64-.61-.438-.406-.664-.972-.672-1.703v-4.546H.391v-1.391h1.437v-2.484h1.516v2.484h2v1.39h-2v4.048c0 .542.101.914.312 1.109.219.187.457.281.719.281.125 0 .242-.008.36-.031.113-.031.222-.067.327-.11l.47 1.36c-.4.133-.86.203-1.391.203zm0 0"/></symbol><symbol id="prefix__g" overflow="visible"><path d="M2.906-10.922c0 .293-.11.547-.328.766-.21.21-.46.312-.75.312-.305 0-.558-.101-.766-.312a1.062 1.062 0 01-.312-.766c0-.3.102-.555.313-.765A1.04 1.04 0 011.828-12c.29 0 .54.105.75.313.219.21.328.464.328.765zm-.312 2.797V0H1.063v-8.125zm0 0"/></symbol><symbol id="prefix__h" overflow="visible"><path d="M4.64.266c-1.21 0-2.21-.41-3-1.235C.86-1.8.47-2.832.47-4.063c0-1.25.39-2.28 1.172-3.093.789-.82 1.789-1.235 3-1.235.832 0 1.554.211 2.171.625.614.418 1.079.993 1.391 1.72l-1.39.577C6.383-6.489 5.628-7 4.546-7c-.7 0-1.305.281-1.813.844-.5.562-.75 1.261-.75 2.093 0 .836.25 1.532.75 2.094.508.563 1.114.844 1.813.844 1.113 0 1.894-.508 2.344-1.531l1.359.578A3.604 3.604 0 016.86-.36c-.637.414-1.376.625-2.22.625zm0 0"/></symbol><symbol id="prefix__i" overflow="visible"><path d="M7.14-2.25c0 .71-.312 1.309-.937 1.797-.617.476-1.39.719-2.328.719-.813 0-1.531-.215-2.156-.641A3.558 3.558 0 01.39-2.063L1.75-2.64c.207.493.5.871.875 1.141.383.273.8.406 1.25.406.488 0 .895-.101 1.219-.312.332-.207.5-.457.5-.75 0-.52-.403-.899-1.203-1.14L3-3.642C1.414-4.047.625-4.812.625-5.937c0-.739.3-1.333.906-1.782.602-.445 1.375-.672 2.313-.672.719 0 1.367.172 1.953.516.582.344.988.805 1.219 1.375l-1.36.563a1.68 1.68 0 00-.765-.797 2.305 2.305 0 00-1.157-.297c-.398 0-.757.101-1.078.297-.312.199-.469.445-.469.734 0 .46.438.793 1.313 1l1.219.313C6.332-4.29 7.14-3.478 7.14-2.25zm0 0"/></symbol></defs><g fill="#747474" stroke-width=".835"><path d="M264.522 42.092c0 11.47-8.973 19.922-19.985 19.922-11.012 0-19.985-8.452-19.985-19.922 0-11.551 8.973-19.922 19.985-19.922 11.012 0 19.985 8.37 19.985 19.922zm-8.749 0c0-7.168-5.2-12.072-11.236-12.072-6.036 0-11.237 4.904-11.237 12.072 0 7.095 5.2 12.071 11.237 12.071 6.036 0 11.236-4.985 11.236-12.071zM307.635 42.092c0 11.47-8.973 19.922-19.985 19.922-11.012 0-19.985-8.452-19.985-19.922 0-11.542 8.973-19.922 19.985-19.922 11.012 0 19.985 8.37 19.985 19.922zm-8.749 0c0-7.168-5.2-12.072-11.236-12.072-6.036 0-11.236 4.904-11.236 12.072 0 7.095 5.2 12.071 11.236 12.071 6.036 0 11.236-4.985 11.236-12.071zM348.952 23.373V59.14c0 14.713-8.677 20.722-18.934 20.722-9.656 0-15.467-6.458-17.659-11.74l7.617-3.17c1.356 3.242 4.68 7.068 10.033 7.068 6.566 0 10.635-4.05 10.635-11.676v-2.865h-.306c-1.958 2.416-5.73 4.527-10.49 4.527-9.962 0-19.087-8.677-19.087-19.841 0-11.246 9.125-19.994 19.086-19.994 4.752 0 8.524 2.11 10.491 4.455h.306v-3.243h8.308zm-7.689 18.79c0-7.014-4.68-12.143-10.634-12.143-6.036 0-11.093 5.129-11.093 12.144 0 6.943 5.057 12 11.093 12 5.955 0 10.634-5.057 10.634-12zM362.65 2.41v58.382h-8.534V2.41zM395.9 48.648l6.79 4.527c-2.19 3.243-7.472 8.83-16.598 8.83-11.317 0-19.77-8.749-19.77-19.922 0-11.847 8.525-19.922 18.791-19.922 10.338 0 15.395 8.227 17.048 12.673l.907 2.264-26.631 11.03c2.038 3.997 5.209 6.035 9.655 6.035 4.455 0 7.545-2.191 9.808-5.515zM375 41.481l17.802-7.392c-.98-2.488-3.925-4.222-7.393-4.222-4.446 0-10.634 3.925-10.41 11.614zM192.253 36.91v-8.453h28.482c.278 1.473.422 3.216.422 5.102 0 6.341-1.734 14.182-7.32 19.77-5.435 5.658-12.378 8.676-21.575 8.676-17.048 0-31.383-13.886-31.383-30.934 0-17.048 14.335-30.934 31.383-30.934 9.43 0 16.15 3.7 21.197 8.524l-5.964 5.964c-3.62-3.395-8.524-6.036-15.242-6.036-12.449 0-22.185 10.033-22.185 22.482s9.736 22.482 22.185 22.482c8.075 0 12.673-3.243 15.62-6.189 2.389-2.39 3.96-5.802 4.58-10.464z"/></g><g transform="matrix(3.54856 0 0 3.54856 -174.95 -339.18)" fill="#747474" stroke-width=".221"><use xlink:href="#prefix__a" x="81.65" y="66" width="100%" height="100%" transform="matrix(1.27573 0 0 1.27573 -9.954 50.463)"/><use xlink:href="#prefix__b" x="92.725" y="66" width="100%" height="100%" transform="matrix(1.27573 0 0 1.27573 -10.404 50.463)"/><use xlink:href="#prefix__c" x="101.629" y="66" width="100%" height="100%" transform="matrix(1.27573 0 0 1.27573 -10.404 50.463)"/><use xlink:href="#prefix__d" x="110.086" y="66" width="100%" height="100%" transform="matrix(1.27573 0 0 1.27573 -10.48 50.463)"/><use xlink:href="#prefix__e" x="113.471" y="66" width="100%" height="100%" transform="matrix(1.27573 0 0 1.27573 -10.629 50.463)"/><use xlink:href="#prefix__f" x="121.712" y="66" width="100%" height="100%" transform="matrix(1.27573 0 0 1.27573 -10.629 50.463)"/><use xlink:href="#prefix__g" x="127.665" y="66" width="100%" height="100%" transform="matrix(1.27573 0 0 1.27573 -10.854 50.463)"/><use xlink:href="#prefix__h" x="131.232" y="66" width="100%" height="100%" transform="matrix(1.27573 0 0 1.27573 -11.454 50.463)"/><use xlink:href="#prefix__i" x="139.888" y="66" width="100%" height="100%" transform="matrix(1.27573 0 0 1.27573 -11.454 50.463)"/></g><g stroke-width=".282"><path d="M94.947 18.126v113.936c0 12.759 8.793 19.853 18.126 19.853 8.632 0 18.126-6.042 18.126-19.853V18.99C131.2 7.31 122.568 0 113.073 0c-9.495 0-18.126 8.065-18.126 18.126zm0 0" fill="#f8ab00"/><path d="M47.473 75.957v56.105c0 12.759 8.794 19.853 18.127 19.853 8.631 0 18.126-6.042 18.126-19.853V76.821c0-11.68-8.632-18.99-18.126-18.99-9.495 0-18.127 8.065-18.127 18.126zm0 0M36.252 133.789c0 10.007-8.119 18.126-18.126 18.126C8.12 151.915 0 143.796 0 133.789c0-10.007 8.119-18.126 18.126-18.126 10.007 0 18.126 8.119 18.126 18.126" fill="#e37300"/></g></svg>
        </a>
    </span>
    <span>
        <a href="https://github.com/tomasfn87/clean-and-indent-GA4-events" target="_blank" title="This website repository @github.com/tomasfn87"><h3></h3></a>
    </span>
    <main>
        <textarea id="text-to-clean" title="GA4 request payload to be decoded and indented" placeholder="Paste your Google Analytics 4 encoded request payload here"></textarea>
        <br>
        <button id="clean-text" onclick="cleanText()">Decode and Indent</button>
    </main>
</body>
<script>
    const removeFirstLineBreaks = (text) => {
        let cleanText = ''
        let position
        for (i in text) {
            if (text[i] != '\n') {
                position = i
                break
            }
        }
        cleanText += text.slice(position, text.length)
        return cleanText.trim()
    }

    const cleanAndIndent = (text) => {
        const REEventName = /en=/g
        const REEventParameter = /&/g
        let cleanText = ''
        cleanText = decodeURIComponent(text)
        cleanText = cleanText.replaceAll(REEventName, '\nen=')
        cleanText = cleanText.replaceAll(REEventParameter, '\n- &')
        return removeFirstLineBreaks(cleanText)
    }

    const cleanText = () => {
        textarea = document.getElementById('text-to-clean')
        textarea.value = cleanAndIndent(textarea.value)
    }

    (document.querySelector('h3').innerText = document.getElementsByTagName('title')[0].innerText)()
</script>
</html>